#!/bin/bash

SERVER="::1"
PORT=3490
TOTAL=200

for i in $(seq 1 $TOTAL); do
{
    CMD="<COMMANDS> yes"
    FILES="<FILES>"
    FILES+="<file_1.txt,Hello from file ${i}_1>"
    FILES+="<file_2.txt,Data for file ${i}_2>"
    FILES+="<file_3.txt,More content from file ${i}_3>"
    END="<END>"

    FULL_REQ="${CMD}\n${FILES}\n${END}"

    # Send the full request
    RESPONSE=$(echo -e "$FULL_REQ" | nc -q 1 -6 "$SERVER" "$PORT")

    # Build expected response based on file contents
	EXPECTED="Hello from file ${i}_1Data for file ${i}_2More content from file ${i}_3"


    # Compare response to expected output
    if [[ "$RESPONSE" == "$EXPECTED" ]]; then
        echo "[$i] ✅ Success"
    else
        echo "[$i] ❌ Failed"
        echo "Expected:"
        echo "$EXPECTED"
        echo "Got:"
        echo "$RESPONSE"
    fi
} &
done

wait
echo "All commands with files sent."
